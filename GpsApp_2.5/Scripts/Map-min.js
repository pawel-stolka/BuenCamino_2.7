function Initialize(){InitMap(),MarkPlaces(),AddMapListeners()}function setInitials(){_zoom=6,startLat=53.5775,startLng=23.10611}function InitMap(){setInitials();var o=new google.maps.LatLng(startLat,startLng),n={zoom:_zoom,center:o,draggableCursor:"crosshair",mapTypeId:"terrain"};map=new google.maps.Map(document.getElementById("map_canvas"),n)}function MarkPlaces(){geoData=[],getPoints_fromDb().done(function(i){o(i),n(),ConnectAllPoints(),ZoomOnBounds(),$("#message").text("imported "+i.length+" points. Click on map to add new...")}).fail(function(){$("#message").text("sorry, no data...")});var o=function(o){$.each(o,function(o,n){var i={Latitude:parseFloat(n.Latitude),Longitude:parseFloat(n.Longitude)};geoData.push(i)})},n=function(){geoData.length>0?(removeMarkers(),$.each(geoData,function(o,n){var i={lat:n.Latitude,lng:n.Longitude,name:n.PlaceName};AddMarker(i,"green")})):$("#message").html("geoData empty...")}}function AddMarker(o,n){var i=new google.maps.LatLng(o),r="http://maps.google.com/mapfiles/ms/icons/"+n+"-dot.png",l=new google.maps.Marker({position:i,map:map,animation:google.maps.Animation.DROP,title:o.name});l.setIcon(r),markers.push(l)}function drawPolyline(o,n){var i=[{lat:o.lat,lng:o.lng},{lat:n.lat,lng:n.lng}],r=new google.maps.Polyline({path:i,geodesic:!0,strokeColor:polyline_details.color,strokeOpacity:polyline_details.opacity,strokeWeight:polyline_details.weight});r.setMap(map)}function ConnectAllPoints(){var o=[];$.each(geoData,function(n,i){var r={lat:parseFloat(i.Latitude),lng:parseFloat(i.Longitude)};o.push(r)});var n=o.length;if(n>1)for(var i=1;n>i;i++)drawPolyline(o[i-1],o[i])}function AddMapListeners(){var o,n,i;map.addListener("mousemove",function(o){var n=o.latLng,i=n.lat(),r=n.lng();$("#moveLat").html(parseFloat(i).toFixed(8)),$("#moveLng").html(parseFloat(r).toFixed(8))}),map.addListener("mouseout",function(){$("#moveLat").html(""),$("#moveLng").html("")}),map.addListener("click",function(o){var n=r(o);l(n),u("/Point/Create?routeId="+i)}),map.addListener("rightclick",function(){console.log("right click")});var r=function(i){var r=i.latLng.lat(),l=i.latLng.lng(),g=parseFloat(r),d=parseFloat(l);return o=g.toFixed(8),n=d.toFixed(8),{lat:g,lng:d}},l=function(o){d(),g(),c(o,"yellow")},g=function(){localStorage.setItem("_latitude",o),localStorage.setItem("_longitude",n),localStorage.setItem("_routeId",i)},d=function(){i=getIdFromUrl()},c=function(o){var n="yellow";removeMarkers(),o.name="temporal",AddMarker(o,n)},u=function(o){window.location=o}}function ZoomOnBounds(){var o=new google.maps.LatLngBounds;markers.length>0?($.each(markers,function(n,i){var r=i.position.lat(),l=i.position.lng(),g=new google.maps.LatLng(r,l);o.extend(g)}),map.fitBounds(o)):$("#message").text("markers.length = 0")}function SetZoomAfterBounds(){google.maps.event.addListener(map,"zoom_changed",function(){zoomChangeBoundsListener=google.maps.event.addListener(map,"bounds_changed",function(){this.getZoom()>15&&this.setZoom(minimalZoom),google.maps.event.removeListener(zoomChangeBoundsListener)})}),map.initialZoom=!0}function removeMarkers(){for(var o=0;o<markers.length;o++)markers[o].setMap(null);markers=[]}function showMessage(o){$("#message").text(o)}var map,_zoom,geoData=[],markers=[],minimalZoom=14,selectedMode="DRIVING",polyline_details={color:"#0066ff",opacity:.65,weight:5},getIdFromUrl=function(){var o=window.location.href,n=o.lastIndexOf("/")+1,i=o.substr(n);return i},getPoints_fromDb=function(){var o=getIdFromUrl();return $.getJSON("/Route/GetPointsJson?id="+o)};